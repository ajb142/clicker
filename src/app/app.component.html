<div class="container-fluid vh-100 d-flex flex-column">
  <!-- Header -->
  <header class="bg-dark text-white py-3 mb-0">
    <div class="container-lg">
      <h1 class="mb-0">{{ title }}</h1>
    </div>
  </header>

  <!-- Actions Bar (underneath banner) -->
  <div class="bg-light border-bottom py-2 mb-4">
    <div class="container-lg">
      <div class="d-flex flex-wrap gap-2 justify-content-center">
        <button class="btn btn-sm btn-outline-success" (click)="openAddTopicModal()" title="Add new topic">
          <i class="bi bi-plus-circle"></i> Add Topic
        </button>
        <button class="btn btn-sm btn-outline-info" (click)="exportData()" title="Export data as CSV">
          <i class="bi bi-download"></i> Export
        </button>
        <button class="btn btn-sm btn-outline-warning" (click)="clearData()" title="Clear all data">
          <i class="bi bi-trash"></i> Clear
        </button>
        <button class="btn btn-sm btn-outline-danger" (click)="resetTopics()" title="Reset to default topics">
          <i class="bi bi-arrow-counterclockwise"></i> Reset
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="flex-grow-1 overflow-auto">
    <div class="container-lg">
      <!-- Alert for Capacity Reached -->
      <div *ngIf="capacityReachedAlert" class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Capacity Reached!</strong> Maximum 2000 events stored. Clear data or reset topics to continue logging.
        <button type="button" class="btn-close" (click)="dismissAlert()"></button>
      </div>

      <!-- Topic Buttons Section -->
      <section class="mb-4">
        <h2 class="h5 mb-3">Topics</h2>
        <div class="topics-grid">
          <button
            *ngFor="let topic of topics"
            class="btn btn-lg topic-btn"
            [style.backgroundColor]="topic.color"
            [style.color]="getContrastColor(topic.color)"
            (click)="incrementTopic(topic.id)">
            {{ topic.name }}
            <br>
            <small>{{ topic.count }}</small>
          </button>
        </div>
      </section>

      <!-- Charts Section -->
      <section class="mb-4">
        <h2 class="h5 mb-3">Pie Chart (Totals)</h2>
        <div class="chart-container">
          <div class="card">
            <div class="card-body">
              <canvas
                baseChart
                type="pie"
                [data]="pieChartData"
                [options]="pieChartOptions">
              </canvas>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-4">
        <h2 class="h5 mb-3">Timeline (Cumulative)</h2>
        <div class="chart-container">
          <div class="card">
            <div class="card-body">
              <canvas
                baseChart
                type="bar"
                [data]="lineChartData"
                [options]="lineChartOptions">
              </canvas>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Add Topic Modal -->
  <div class="modal" [class.show]="showAddTopicModal" [style.display]="showAddTopicModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Topic</h5>
          <button type="button" class="btn-close" (click)="closeAddTopicModal()"></button>
        </div>
        <div class="modal-body">
          <input
            #topicNameInput
            type="text"
            class="form-control"
            placeholder="Enter topic name"
            [(ngModel)]="newTopicName"
            (keyup.enter)="addTopic()">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeAddTopicModal()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="addTopic()" [disabled]="!newTopicName.trim()">Add Topic</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" [class.show]="showConfirmModal" [style.display]="showConfirmModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ confirmModalTitle }}</h5>
          <button type="button" class="btn-close" (click)="closeConfirmModal()"></button>
        </div>
        <div class="modal-body">
          <p>{{ confirmModalMessage }}</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeConfirmModal()">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="confirmAction()">Confirm</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop fade" [class.show]="showAddTopicModal || showConfirmModal" *ngIf="showAddTopicModal || showConfirmModal"></div>

  <!-- Footer -->
  <footer class="bg-light border-top text-center py-3 mt-auto">
    <small class="text-muted">Events logged: {{ timeline.length }} / {{ 2000 }}</small>
  </footer>
</div>

<router-outlet />
